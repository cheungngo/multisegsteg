% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/balance.R
\name{balance_drug_dataset_zero}
\alias{balance_drug_dataset_zero}
\title{Balance Drug Dataset by Reducing Zero Dose Entries}
\usage{
balance_drug_dataset_zero(
  df,
  formula1,
  formula2,
  target_percentage = 0.05,
  random_seed = 42
)
}
\arguments{
\item{df}{The input dataset, a data.frame.}

\item{formula1}{A formula or character string specifying the outcome and predictor variables for stratification,
e.g., "cholesterol ~ age + Gender + education + dose.METFORMIN + dose.ATORVASTATIN".}

\item{formula2}{A formula or character string specifying the drug variable to balance,
e.g., "~dose.CLOZAPINE" or "~wz_dose.CLOZAPINE".}

\item{target_percentage}{The target percentage of zero entries to keep for the specified drug variable.
Default is 0.05 (5\%).}

\item{random_seed}{An integer seed for reproducible sampling. Default is 42.}
}
\value{
A new data.frame with the balanced dataset, where zero entries for the specified drug variable
are reduced to approximately the target percentage, and all non-zero entries are retained,
while maintaining the distributions of specified variables.
}
\description{
Creates a balanced dataset by reducing entries where a specified drug dose is zero to a target percentage,
while preserving the distributions of variables specified in the provided formulas.
}
\details{
The function identifies the drug variable from \code{formula2} (e.g., \code{dose.CLOZAPINE}) and checks for its presence
in the dataset. It extracts stratification variables from \code{formula1} and \code{formula2} (excluding the drug variable).
The dataset is split into zero and non-zero entries based on the drug variable. Zero entries are stratified
by binning continuous variables into quantiles and using categorical variables as-is. A proportional sample
is taken from each stratum to meet the target percentage, ensuring at least one entry per stratum if possible.
The sampled zero entries are combined with all non-zero entries to form the balanced dataset. Diagnostics
verify that variable distributions are preserved.
}
\examples{
# Example with a dataset 'df' containing relevant columns
balanced_df <- balance_drug_dataset_zero(
  df,
  "cholesterol ~ age + Gender + education + dose.METFORMIN",
  "~dose.CLOZAPINE",
  target_percentage = 0.05,
  random_seed = 42
)

}
